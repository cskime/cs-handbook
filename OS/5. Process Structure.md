# Process의 구조

> [Process 기초](https://github.com/cskime/cs-handbook/blob/main/OS/3.%20Process%20Scheduler%20Basic.md)

## Process 구조: Text, Data, Stack, Heap

프로세스는 4GB의 가상 메모리 영역을 할당받고, 네 가지 영역(segment)으로 구분하여 데이터를 저장한다.

<img src="/OS/resources/process-structure.png" width="50%"><br>

1. **Text(Code)** : 소스코드가 컴파일되어 기계어(binary code) 형태로 저장되는 영역
    - 프로그램은 이 영역에 저장된 코드를 한 줄씩 읽으면서 필요한 변수 등을 미리 알 수 있다.
2. **Data** : 전역 변수 및 정적 변수가 저장되는 영역
    - **BSS(Block Stated Symbol)** : 선언만 되어 있고 초기화되지 않은 변수를 저장하는 영역
    - **Data** : 선언과 동시에 초기화된 변수를 저장하는 영역
3. **Stack** : 임시 데이터(함수 호출, 지역 변수 등)를 저장하는 영역
    - 함수 호출 데이터 : 전달인자, return address 등
    - Return address(함수 호출이 종료된 뒤 code 영역에서 다음에 실행될 코드의 주소값) 저장
4. **Heap** : Runtime에 동적으로 할당되는 영역. Runtime에 메모리 크기를 지정해서 동적으로 메모리 공간을 할당받음
    ```C
    #include <stdio.h>
    #include <stdlib.h>  // malloc, free 사용

    int main() {
        int *data;
        data = (int *)malloc(sizeof(int));  // 동적 메모리 할당
        *data = 1;
        printf("%d", *data);
        free(data);     // 동적 할당받은 메모리 해제
        return 0;
    }
    ```
    - `malloc` : Heap 영역에 지정한 크기 만큼 메모리 공간을 할당한다.
    - `free` : Heap 영역에 할당받았던 메모리 공간을 해제한다.


> **BSS(Block Stated Symbol)**
> - Linker/Loader에 의해 할당받는 메모리 공간으로, 실제로 메모리를 차지하지 않음
> - 초기화되지 않은 전역 및 정적 변수는 개념적으로 BSS 영역에 저장되고 쓰레기 값을 가지고 있음
> - Linker 또는 Loader에 명시된 초기화되지 않은 전역 변수에 필요한 메모리 크기를 사용하여 변수를 초기화함

## Process가 실행될 때 Stack 영역의 변화

Process가 실행되면 **Text(Code)** segment에 저장된 코드를 한 줄씩 실행한다.

<img src="/OS/resources/process-stack-execution-text.png" width="50%"><br>



코드가 실행될 때, **Stack** segment는 다음과 같이 데이터를 저장한다.

1. `0001h` 주소의 코드를 읽고 `temp` 

## 컴퓨터 구조 관점에서 Stack 영역의 변화